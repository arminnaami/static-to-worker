{"title":"透過修改 apk 來移除巴哈姆特 app 廣告","slug":"remove-bahamut-app-ads-by-modify-apk","date":"2018-02-05T08:04:41.000Z","updated":"2019-08-16T11:14:47.606Z","comments":true,"path":"api/articles/remove-bahamut-app-ads-by-modify-apk.json","excerpt":"之前已經有一篇阻擋 Android 版巴哈姆特的廣告在講如何阻擋巴哈 app 廣告了<br>但自從 Android 7 開始，Android 對於使用者自己新增的憑證有限制會導致 https 過濾不完全，有 root 的裝置可以使用 Move Certs! 這個 app 來把 AdGuard 的憑證轉為系統憑證，這樣 AdGuard 才能繼續正常過濾<br>因此對於沒 root 的裝置就需要其他辦法來去除廣告了，這就是這篇文章的目的資訊來源: ArguardForAndroid issue #334Move Certs! 的 GitHub releases 中只有 1.0.1 的 apk，最新版 1.0.2 可能要另外找，而它的 Package name 是 com.nutomic.zertman更新: 有使用 Magisk 的人可以去搜尋一個 Move Certificates 的 module 來安裝，功能和 Move Certs! 一樣","covers":null,"content":"<p>之前已經有一篇<a href=\"/2017/11/26/block-android-bahamut-ads/\" title=\"阻擋 Android 版巴哈姆特的廣告\">阻擋 Android 版巴哈姆特的廣告</a>在講如何阻擋巴哈 app 廣告了<br>但自從 Android 7 開始，Android 對於使用者自己新增的憑證有限制會導致 https 過濾不完全，有 root 的裝置可以使用 <a href=\"https://github.com/Nutomic/movecerts/releases\" target=\"_blank\" rel=\"noopener\">Move Certs!</a> 這個 app 來把 AdGuard 的憑證轉為系統憑證，這樣 AdGuard 才能繼續正常過濾<br>因此對於沒 root 的裝置就需要其他辦法來去除廣告了，這就是這篇文章的目的</p>\n<p>資訊來源: <a href=\"https://github.com/AdguardTeam/AdguardForAndroid/issues/334\" target=\"_blank\" rel=\"noopener\">ArguardForAndroid issue #334</a></p>\n<blockquote>\n<p>Move Certs! 的 GitHub releases 中只有 <code>1.0.1</code> 的 apk，最新版 <code>1.0.2</code> 可能要另外找，而它的 Package name 是 <code>com.nutomic.zertman</code></p>\n</blockquote>\n<blockquote>\n<p>更新: 有使用 Magisk 的人可以去搜尋一個 Move Certificates 的 module 來安裝，功能和 Move Certs! 一樣</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h1 id=\"準備\"><a href=\"#準備\" class=\"headerlink\" title=\"準備\"></a>準備</h1><ol>\n<li>安裝 java</li>\n<li>安裝 <a href=\"https://ibotpeaches.github.io/Apktool/install/\" target=\"_blank\" rel=\"noopener\">apktool</a> (內有安裝教學)</li>\n<li>取得原版巴哈姆特 apk (<a href=\"https://apkpure.com/tw/%E5%B7%B4%E5%93%88%E5%A7%86%E7%89%B9/tw.com.gamer.android.activecenter\" target=\"_blank\" rel=\"noopener\">apkpure</a>)</li>\n</ol>\n<p>這篇文章使用版本為</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java=1.8.0_162</span><br><span class=\"line\">apktool=2.3.1</span><br><span class=\"line\">巴哈姆特apk=5.7.0</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"修改\"><a href=\"#修改\" class=\"headerlink\" title=\"修改\"></a>修改</h1><p>在有<code>bahamut.apk</code>的目錄下輸入指令<code>apktool d bahamut.apk</code><br>然後打開<code>./bahamut/smali/tw/com/gamer/android/ad/MobileAdView.smali</code><br>在裡面找到一行</p>\n<figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">.field</span><span class=\"keyword\"> private</span><span class=\"keyword\"> static</span><span class=\"keyword\"> final</span> API:<span class=\"class\">Ljava/lang/String;</span> = <span class=\"string\">\"https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php\"</span></span><br></pre></td></tr></table></figure>\n\n<p>在這邊可以用瀏覽器打開 <a href=\"https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php\" target=\"_blank\" rel=\"noopener\">https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php</a>，會發現是 json 格式的廣告列表修改方式是利用線上服務(gist,pastebin 之類的)來回傳空的廣告列表:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">\"banner\"</span>:&#123;&#125;,<span class=\"string\">\"native_major\"</span>:&#123;<span class=\"string\">\"Android__\"</span>:[],<span class=\"string\">\"iOS__\"</span>:[]&#125;,<span class=\"string\">\"native_minor\"</span>:&#123;<span class=\"string\">\"Android__\"</span>:[],<span class=\"string\">\"iOS__\"</span>:[]&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我已經用上面的內容新增一個 gist 了，懶得新增可以直接複製: <a href=\"https://cdn.rawgit.com/maple3142/d2e5ad1aee53879dadb3fabae257e5e8/raw/fb063a01d90b7e7fb2c22aa9f8890d809f73b778/ad.json\" target=\"_blank\" rel=\"noopener\">url</a><br>然後把剛剛上面那行改成:</p>\n<figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">.field</span><span class=\"keyword\"> private</span><span class=\"keyword\"> static</span><span class=\"keyword\"> final</span> API:<span class=\"class\">Ljava/lang/String;</span> = <span class=\"string\">\"空廣告列表的網址\"</span></span><br></pre></td></tr></table></figure>\n\n<p>再來是第二處要修改一樣是在<code>MobileAdView.smali</code>大約 600 多行的地方找到</p>\n<figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">.method</span><span class=\"keyword\"> public</span><span class=\"keyword\"> static</span> requestAd(/*這邊省略...*/)V</span><br><span class=\"line\">/*其他程式碼*/</span><br><span class=\"line\">/*在這邊應該能找到下方那一行，這個網址也要改*/</span><br><span class=\"line\"></span><br><span class=\"line\">const-string v3, <span class=\"string\">\"https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">.end method</span></span><br></pre></td></tr></table></figure>\n\n<p>這邊的改法也是把 api 網址改成空廣告列表的網址</p>\n<p>然後再度回到有<code>bahamut.apk</code>的資料夾下執行指令<code>apktool b bahamut -o bahamut_noads.apk</code><br>之後就會產生出沒有廣告的巴哈姆特 apk: <code>bahamut_noads.apk</code><br>不過這個 apk 因為還沒有簽名所以無法直接安裝(有核心破解就可以跳過簽名的部分)</p>\n<h1 id=\"簽名\"><a href=\"#簽名\" class=\"headerlink\" title=\"簽名\"></a>簽名</h1><p><em>已經會幫 apk 簽名的請直接跳過這一部份</em><br>為了簡化簽名的方法，這邊會使用第三方工具 <a href=\"https://github.com/patrickfav/uber-apk-signer\" target=\"_blank\" rel=\"noopener\">uber-apk-signer</a><br>到 <a href=\"https://github.com/patrickfav/uber-apk-signer/releases\" target=\"_blank\" rel=\"noopener\">Releases</a> 頁面選擇最新版的，在下面找到<code>uber-apk-signer-x.y.z.jar</code>下載(x.y.z 是版本號)</p>\n<p>然後把下載回來的<code>uber-apk-signer-x.y.z.jar</code>放到與<code>bahamut_noads.apk</code>同個目錄下並改名<code>sign.jar</code><br>然後執行指令<code>java -jar sign.jar --apks ./bahamut_noads.apk</code><br>最後會得到<code>bahamut_noads-aligned-debugSigned.apk</code>，就可以傳到手機上去安裝<br><strong>安裝前請務必把原版巴哈姆特 app 移除</strong></p>\n<h1 id=\"關於去廣告\"><a href=\"#關於去廣告\" class=\"headerlink\" title=\"關於去廣告\"></a>關於去廣告</h1><p>如果可以的話我是希望巴哈能像動畫瘋一樣推出付費去廣告的方法，但是目前(2018/2/5 17:57)還沒有這種方法來去廣告當然如果想要靠看廣告支持巴哈姆特的營運的話可以繼續使用官方 app<br>而如果和我一樣看到廣告就不舒服的話請自己按照這篇文章的方法去去廣告，我沒有打算開放下載修改後的 apk</p>\n<h1 id=\"更新紀錄\"><a href=\"#更新紀錄\" class=\"headerlink\" title=\"更新紀錄\"></a>更新紀錄</h1><ul>\n<li>2018/4/11 更新: 巴哈姆特 5.7.5 版有很大的改動，目前最新能修改的版本為 5.7.3</li>\n<li>2018/8/20 更新: 修改 Move Certs! 的連結，因為它已經從 Google Play 消失了</li>\n</ul>\n","more":"<h1 id=\"準備\"><a href=\"#準備\" class=\"headerlink\" title=\"準備\"></a>準備</h1><ol>\n<li>安裝 java</li>\n<li>安裝 <a href=\"https://ibotpeaches.github.io/Apktool/install/\" target=\"_blank\" rel=\"noopener\">apktool</a> (內有安裝教學)</li>\n<li>取得原版巴哈姆特 apk (<a href=\"https://apkpure.com/tw/%E5%B7%B4%E5%93%88%E5%A7%86%E7%89%B9/tw.com.gamer.android.activecenter\" target=\"_blank\" rel=\"noopener\">apkpure</a>)</li>\n</ol>\n<p>這篇文章使用版本為</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java=1.8.0_162</span><br><span class=\"line\">apktool=2.3.1</span><br><span class=\"line\">巴哈姆特apk=5.7.0</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"修改\"><a href=\"#修改\" class=\"headerlink\" title=\"修改\"></a>修改</h1><p>在有<code>bahamut.apk</code>的目錄下輸入指令<code>apktool d bahamut.apk</code><br>然後打開<code>./bahamut/smali/tw/com/gamer/android/ad/MobileAdView.smali</code><br>在裡面找到一行</p>\n<figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">.field</span><span class=\"keyword\"> private</span><span class=\"keyword\"> static</span><span class=\"keyword\"> final</span> API:<span class=\"class\">Ljava/lang/String;</span> = <span class=\"string\">\"https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php\"</span></span><br></pre></td></tr></table></figure>\n\n<p>在這邊可以用瀏覽器打開 <a href=\"https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php\" target=\"_blank\" rel=\"noopener\">https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php</a>，會發現是 json 格式的廣告列表修改方式是利用線上服務(gist,pastebin 之類的)來回傳空的廣告列表:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">\"banner\"</span>:&#123;&#125;,<span class=\"string\">\"native_major\"</span>:&#123;<span class=\"string\">\"Android__\"</span>:[],<span class=\"string\">\"iOS__\"</span>:[]&#125;,<span class=\"string\">\"native_minor\"</span>:&#123;<span class=\"string\">\"Android__\"</span>:[],<span class=\"string\">\"iOS__\"</span>:[]&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我已經用上面的內容新增一個 gist 了，懶得新增可以直接複製: <a href=\"https://cdn.rawgit.com/maple3142/d2e5ad1aee53879dadb3fabae257e5e8/raw/fb063a01d90b7e7fb2c22aa9f8890d809f73b778/ad.json\" target=\"_blank\" rel=\"noopener\">url</a><br>然後把剛剛上面那行改成:</p>\n<figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">.field</span><span class=\"keyword\"> private</span><span class=\"keyword\"> static</span><span class=\"keyword\"> final</span> API:<span class=\"class\">Ljava/lang/String;</span> = <span class=\"string\">\"空廣告列表的網址\"</span></span><br></pre></td></tr></table></figure>\n\n<p>再來是第二處要修改一樣是在<code>MobileAdView.smali</code>大約 600 多行的地方找到</p>\n<figure class=\"highlight smali\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">.method</span><span class=\"keyword\"> public</span><span class=\"keyword\"> static</span> requestAd(/*這邊省略...*/)V</span><br><span class=\"line\">/*其他程式碼*/</span><br><span class=\"line\">/*在這邊應該能找到下方那一行，這個網址也要改*/</span><br><span class=\"line\"></span><br><span class=\"line\">const-string v3, <span class=\"string\">\"https://api.gamer.com.tw/mobile_app/ad/v2/mobile_ad.php\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">.end method</span></span><br></pre></td></tr></table></figure>\n\n<p>這邊的改法也是把 api 網址改成空廣告列表的網址</p>\n<p>然後再度回到有<code>bahamut.apk</code>的資料夾下執行指令<code>apktool b bahamut -o bahamut_noads.apk</code><br>之後就會產生出沒有廣告的巴哈姆特 apk: <code>bahamut_noads.apk</code><br>不過這個 apk 因為還沒有簽名所以無法直接安裝(有核心破解就可以跳過簽名的部分)</p>\n<h1 id=\"簽名\"><a href=\"#簽名\" class=\"headerlink\" title=\"簽名\"></a>簽名</h1><p><em>已經會幫 apk 簽名的請直接跳過這一部份</em><br>為了簡化簽名的方法，這邊會使用第三方工具 <a href=\"https://github.com/patrickfav/uber-apk-signer\" target=\"_blank\" rel=\"noopener\">uber-apk-signer</a><br>到 <a href=\"https://github.com/patrickfav/uber-apk-signer/releases\" target=\"_blank\" rel=\"noopener\">Releases</a> 頁面選擇最新版的，在下面找到<code>uber-apk-signer-x.y.z.jar</code>下載(x.y.z 是版本號)</p>\n<p>然後把下載回來的<code>uber-apk-signer-x.y.z.jar</code>放到與<code>bahamut_noads.apk</code>同個目錄下並改名<code>sign.jar</code><br>然後執行指令<code>java -jar sign.jar --apks ./bahamut_noads.apk</code><br>最後會得到<code>bahamut_noads-aligned-debugSigned.apk</code>，就可以傳到手機上去安裝<br><strong>安裝前請務必把原版巴哈姆特 app 移除</strong></p>\n<h1 id=\"關於去廣告\"><a href=\"#關於去廣告\" class=\"headerlink\" title=\"關於去廣告\"></a>關於去廣告</h1><p>如果可以的話我是希望巴哈能像動畫瘋一樣推出付費去廣告的方法，但是目前(2018/2/5 17:57)還沒有這種方法來去廣告當然如果想要靠看廣告支持巴哈姆特的營運的話可以繼續使用官方 app<br>而如果和我一樣看到廣告就不舒服的話請自己按照這篇文章的方法去去廣告，我沒有打算開放下載修改後的 apk</p>\n<h1 id=\"更新紀錄\"><a href=\"#更新紀錄\" class=\"headerlink\" title=\"更新紀錄\"></a>更新紀錄</h1><ul>\n<li>2018/4/11 更新: 巴哈姆特 5.7.5 版有很大的改動，目前最新能修改的版本為 5.7.3</li>\n<li>2018/8/20 更新: 修改 Move Certs! 的連結，因為它已經從 Google Play 消失了</li>\n</ul>","categories":[{"name":"研究","path":"api/categories/研究.json"}],"tags":[{"name":"Bahamut","path":"api/tags/Bahamut.json"},{"name":"ads","path":"api/tags/ads.json"},{"name":"android","path":"api/tags/android.json"},{"name":"apk","path":"api/tags/apk.json"}]}