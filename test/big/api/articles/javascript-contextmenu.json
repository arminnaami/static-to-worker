{"title":"javascript 右鍵選單","slug":"javascript-contextmenu","date":"2017-11-22T15:12:27.000Z","updated":"2019-08-16T11:14:47.593Z","comments":true,"path":"api/articles/javascript-contextmenu.json","excerpt":"我在有空的時候試著用純 javascript 實作了一個簡單的右鍵選單<br>雖然沒搞什麼複雜的 css，外觀也很醜，但基本上以功能來說是可以用的","covers":null,"content":"<p>我在有空的時候試著用純 javascript 實作了一個簡單的右鍵選單<br>雖然沒搞什麼複雜的 css，外觀也很醜，但基本上以功能來說是可以用的</p>\n<a id=\"more\"></a>\n\n<h1 id=\"範例\"><a href=\"#範例\" class=\"headerlink\" title=\"範例\"></a>範例</h1><p><del>css 有一部分其實是仿 bootstrap 的</del></p>\n<p><a href=\"https://codepen.io/maple3142/pen/qVKoqq/\" target=\"_blank\" rel=\"noopener\">DEMO</a></p>\n<h1 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctxmenu = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.ctxmenu'</span>) <span class=\"comment\">//選單元素</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> baseEL = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.box'</span>) <span class=\"comment\">//要自訂選單的元素</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"處理事件\"><a href=\"#處理事件\" class=\"headerlink\" title=\"處理事件\"></a>處理事件</h1><h2 id=\"顯示選單\"><a href=\"#顯示選單\" class=\"headerlink\" title=\"顯示選單\"></a>顯示選單</h2><p>簡單來說就是把選單的位置移動到 event 的位置，然後顯示他</p>\n<p>還有很重要的是要呼叫<code>stopPropagation()</code>這個函數，和後面做的事情有關</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">baseEL.addEventListener(<span class=\"string\">'contextmenu'</span>, e =&gt; &#123;</span><br><span class=\"line\">  e.preventDefault()</span><br><span class=\"line\">  e.stopPropagation() <span class=\"comment\">//important!!</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//move element</span></span><br><span class=\"line\">  ctxmenu.style.top = e.y + <span class=\"string\">'px'</span></span><br><span class=\"line\">  ctxmenu.style.left = e.x + <span class=\"string\">'px'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//show element</span></span><br><span class=\"line\">  ctxmenu.classList.add(<span class=\"string\">'show'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"取消選單\"><a href=\"#取消選單\" class=\"headerlink\" title=\"取消選單\"></a>取消選單</h2><p>這邊會看到<code>contextmenu</code>和<code>click</code>都做一樣的事情，就是隱藏選單</p>\n<p>而如果在前面的步驟沒有<code>stopPropagation()</code>的話會導致點擊在指定元素時也會同時移除<code>show</code>這個 class</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'contextmenu'</span>, e =&gt; &#123;</span><br><span class=\"line\">  ctxmenu.classList.remove(<span class=\"string\">'show'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'click'</span>, e =&gt; &#123;</span><br><span class=\"line\">  ctxmenu.classList.remove(<span class=\"string\">'show'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n","more":"<h1 id=\"範例\"><a href=\"#範例\" class=\"headerlink\" title=\"範例\"></a>範例</h1><p><del>css 有一部分其實是仿 bootstrap 的</del></p>\n<p><a href=\"https://codepen.io/maple3142/pen/qVKoqq/\" target=\"_blank\" rel=\"noopener\">DEMO</a></p>\n<h1 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctxmenu = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.ctxmenu'</span>) <span class=\"comment\">//選單元素</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> baseEL = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.box'</span>) <span class=\"comment\">//要自訂選單的元素</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"處理事件\"><a href=\"#處理事件\" class=\"headerlink\" title=\"處理事件\"></a>處理事件</h1><h2 id=\"顯示選單\"><a href=\"#顯示選單\" class=\"headerlink\" title=\"顯示選單\"></a>顯示選單</h2><p>簡單來說就是把選單的位置移動到 event 的位置，然後顯示他</p>\n<p>還有很重要的是要呼叫<code>stopPropagation()</code>這個函數，和後面做的事情有關</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">baseEL.addEventListener(<span class=\"string\">'contextmenu'</span>, e =&gt; &#123;</span><br><span class=\"line\">  e.preventDefault()</span><br><span class=\"line\">  e.stopPropagation() <span class=\"comment\">//important!!</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//move element</span></span><br><span class=\"line\">  ctxmenu.style.top = e.y + <span class=\"string\">'px'</span></span><br><span class=\"line\">  ctxmenu.style.left = e.x + <span class=\"string\">'px'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//show element</span></span><br><span class=\"line\">  ctxmenu.classList.add(<span class=\"string\">'show'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"取消選單\"><a href=\"#取消選單\" class=\"headerlink\" title=\"取消選單\"></a>取消選單</h2><p>這邊會看到<code>contextmenu</code>和<code>click</code>都做一樣的事情，就是隱藏選單</p>\n<p>而如果在前面的步驟沒有<code>stopPropagation()</code>的話會導致點擊在指定元素時也會同時移除<code>show</code>這個 class</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'contextmenu'</span>, e =&gt; &#123;</span><br><span class=\"line\">  ctxmenu.classList.remove(<span class=\"string\">'show'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'click'</span>, e =&gt; &#123;</span><br><span class=\"line\">  ctxmenu.classList.remove(<span class=\"string\">'show'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>","categories":[{"name":"javascript","path":"api/categories/javascript.json"}],"tags":[{"name":"javascript","path":"api/tags/javascript.json"}]}