{"title":"Hexo NexT 主題的閱讀次數統計","slug":"hexo-next-readcount","date":"2017-11-04T03:20:14.000Z","updated":"2019-08-16T11:14:47.580Z","comments":true,"path":"api/articles/hexo-next-readcount.json","excerpt":"這是一個在 Next 主題上的小功能可以在文章及首頁顯示文章的閱讀次數使用了 firestore 作為資料庫<br>之前發的 PR需要 Next v5.1.4 以上的版本更新: 目前已不建議使用此插件","covers":["./example.jpg","./createproj.jpg","./choosedb.jpg","./getapi.jpg","./example.jpg","./rule.jpg"],"content":"<p>這是一個在 <a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">Next</a> 主題上的小功能可以在文章及首頁顯示文章的閱讀次數使用了 <a href=\"https://firebase.google.com/docs/firestore/\" target=\"_blank\" rel=\"noopener\">firestore</a> 作為資料庫<br><a href=\"https://github.com/iissnan/hexo-theme-next/pulls?utf8=%E2%9C%93&q=is%3Apr%20firestore%20\" target=\"_blank\" rel=\"noopener\">之前發的 PR</a></p>\n<blockquote>\n<p>需要 Next v5.1.4 以上的版本</p>\n</blockquote>\n<blockquote>\n<p>更新: 目前已不建議使用此插件</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p><img src=\"./example.jpg\" alt=\"預覽圖\"></p>\n<h1 id=\"使用教學\"><a href=\"#使用教學\" class=\"headerlink\" title=\"使用教學\"></a>使用教學</h1><h2 id=\"取得-firestore-資料庫\"><a href=\"#取得-firestore-資料庫\" class=\"headerlink\" title=\"取得 firestore 資料庫\"></a>取得 firestore 資料庫</h2><p>到 <a href=\"https://console.firebase.google.com/u/0/\" target=\"_blank\" rel=\"noopener\">firebase 網站</a> 創建一個專案<br><em>專案名稱之類的都可以自己選</em><br><img src=\"./createproj.jpg\" alt=\"創建專案\"></p>\n<p>接下來創建完成之後在左側選擇 <em>Database</em> 會出現選擇資料庫的頁面在這個步驟請選擇右側的 <strong>Cloud Firestore</strong><br><img src=\"./choosedb.jpg\" alt=\"選擇資料庫\"><br>然後選擇 <strong>以測試模式啟動</strong> (之後會再設定安全性)<br><img src=\"./default_security.jpg\" alt=\"選擇模式\"></p>\n<h2 id=\"設定-config-yml\"><a href=\"#設定-config-yml\" class=\"headerlink\" title=\"設定 _config.yml\"></a>設定 _config.yml</h2><p>在上面的步驟建立完成 firestore 資料庫之後按照下面的圖片裡的 <strong>1</strong>,<strong>2</strong> 點擊然後會看到圖片中的資訊，projectid 和 apikey 是待會在設定檔裡面要用到的<br><img src=\"./getapi.jpg\" alt=\"取得apikey\"></p>\n<p>接下來開啟主題的<code>_config.yml</code> (<code>themes/next/_config.yml</code>) 並且找到 <code>firestore</code>的部分預設值:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Another tool to show number of visitors to each article.</span></span><br><span class=\"line\"><span class=\"comment\"># visit https://console.firebase.google.com/u/0/ to get apiKey and projectId</span></span><br><span class=\"line\"><span class=\"comment\"># visit https://firebase.google.com/docs/firestore/ to get more information about firestore</span></span><br><span class=\"line\"><span class=\"attr\">firestore:</span></span><br><span class=\"line\"><span class=\"attr\">  enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  collection:</span> <span class=\"string\">articles</span> <span class=\"comment\">#required, a string collection name to access firestore database</span></span><br><span class=\"line\"><span class=\"attr\">  apiKey:</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  projectId:</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  bluebird:</span> <span class=\"literal\">false</span> <span class=\"comment\">#enable this if you want to include bluebird 3.5.1(core version) Promise polyfill</span></span><br></pre></td></tr></table></figure>\n\n<p>把<code>enable</code>設定成<code>true</code><br>然後把前面得到的<code>apikey</code>和<code>projectId</code>填入對應的欄位中<br><code>collection</code>改不改都行，不知道這是什麼的話請別更改</p>\n<blockquote>\n<p>collection 的值會影響閱讀次數的數值儲存在哪裡</p>\n</blockquote>\n<p>如果需要支援一些老舊的瀏覽器請把<code>bluebird</code>設定成<code>true</code></p>\n<blockquote>\n<p>Bluebird 為了支援 Promise ，詳細的相容性可以到 <a href=\"https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise#瀏覽器相容性\" target=\"_blank\" rel=\"noopener\">MDN</a> 上看</p>\n</blockquote>\n<p>改完的 _config.yml:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">firestore:</span></span><br><span class=\"line\"><span class=\"attr\">  enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  collection:</span> <span class=\"string\">articles</span></span><br><span class=\"line\"><span class=\"attr\">  apiKey:</span> <span class=\"string\">AIzaSyDcPXjPoq3kEL245f4P4SDPop7uAD-XZXc</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  projectId:</span> <span class=\"string\">hexo-next-firestore-example</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  bluebird:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"測試\"><a href=\"#測試\" class=\"headerlink\" title=\"測試\"></a>測試</h2><p>接下來執行<code>hexo s</code>啟動測試伺服器應該要在首頁的每篇文章的標題下面看到<strong>閱讀次數</strong></p>\n<p>然後點進任何一篇文章也要在標題下面看到<strong>閱讀次數</strong><br><img src=\"./example.jpg\" alt=\"預覽圖\"></p>\n<h2 id=\"firestore-安全設定\"><a href=\"#firestore-安全設定\" class=\"headerlink\" title=\"firestore 安全設定\"></a>firestore 安全設定</h2><p><strong>這個步驟可做可不做</strong></p>\n<p>接下來在 firebase 裡面回到 Database 頁面，然後選擇上面的<strong>規則</strong><br><img src=\"./rule.jpg\" alt=\"firestore規則\"></p>\n<p>把裡面的值改成下面的來限制只有<code>articles</code>這個 collection 可以被修改如果在前面的設定裡的<code>collection</code>的值不是<code>articles</code>的話下面也要修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service cloud.firestore &#123;</span><br><span class=\"line\">  match /databases/&#123;database&#125;/documents &#123;</span><br><span class=\"line\">    match /articles/&#123;any&#125; &#123;</span><br><span class=\"line\">      allow read: if true;</span><br><span class=\"line\">      allow write: if request.resource.data.count==resource.data.count+1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"後記\"><a href=\"#後記\" class=\"headerlink\" title=\"後記\"></a>後記</h1><p>會弄出這個功能的原因是不想使用原本就有的 <a href=\"https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud\" target=\"_blank\" rel=\"noopener\">LeanCloud 統計功能</a> (這個的設定方法比較簡單)<br>所以就自己用 javascript 來簡單的實作了一個統計次數的功能然後發 PR 給主題</p>\n","more":"<p><img src=\"./example.jpg\" alt=\"預覽圖\"></p>\n<h1 id=\"使用教學\"><a href=\"#使用教學\" class=\"headerlink\" title=\"使用教學\"></a>使用教學</h1><h2 id=\"取得-firestore-資料庫\"><a href=\"#取得-firestore-資料庫\" class=\"headerlink\" title=\"取得 firestore 資料庫\"></a>取得 firestore 資料庫</h2><p>到 <a href=\"https://console.firebase.google.com/u/0/\" target=\"_blank\" rel=\"noopener\">firebase 網站</a> 創建一個專案<br><em>專案名稱之類的都可以自己選</em><br><img src=\"./createproj.jpg\" alt=\"創建專案\"></p>\n<p>接下來創建完成之後在左側選擇 <em>Database</em> 會出現選擇資料庫的頁面在這個步驟請選擇右側的 <strong>Cloud Firestore</strong><br><img src=\"./choosedb.jpg\" alt=\"選擇資料庫\"><br>然後選擇 <strong>以測試模式啟動</strong> (之後會再設定安全性)<br><img src=\"./default_security.jpg\" alt=\"選擇模式\"></p>\n<h2 id=\"設定-config-yml\"><a href=\"#設定-config-yml\" class=\"headerlink\" title=\"設定 _config.yml\"></a>設定 _config.yml</h2><p>在上面的步驟建立完成 firestore 資料庫之後按照下面的圖片裡的 <strong>1</strong>,<strong>2</strong> 點擊然後會看到圖片中的資訊，projectid 和 apikey 是待會在設定檔裡面要用到的<br><img src=\"./getapi.jpg\" alt=\"取得apikey\"></p>\n<p>接下來開啟主題的<code>_config.yml</code> (<code>themes/next/_config.yml</code>) 並且找到 <code>firestore</code>的部分預設值:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Another tool to show number of visitors to each article.</span></span><br><span class=\"line\"><span class=\"comment\"># visit https://console.firebase.google.com/u/0/ to get apiKey and projectId</span></span><br><span class=\"line\"><span class=\"comment\"># visit https://firebase.google.com/docs/firestore/ to get more information about firestore</span></span><br><span class=\"line\"><span class=\"attr\">firestore:</span></span><br><span class=\"line\"><span class=\"attr\">  enable:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">  collection:</span> <span class=\"string\">articles</span> <span class=\"comment\">#required, a string collection name to access firestore database</span></span><br><span class=\"line\"><span class=\"attr\">  apiKey:</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  projectId:</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  bluebird:</span> <span class=\"literal\">false</span> <span class=\"comment\">#enable this if you want to include bluebird 3.5.1(core version) Promise polyfill</span></span><br></pre></td></tr></table></figure>\n\n<p>把<code>enable</code>設定成<code>true</code><br>然後把前面得到的<code>apikey</code>和<code>projectId</code>填入對應的欄位中<br><code>collection</code>改不改都行，不知道這是什麼的話請別更改</p>\n<blockquote>\n<p>collection 的值會影響閱讀次數的數值儲存在哪裡</p>\n</blockquote>\n<p>如果需要支援一些老舊的瀏覽器請把<code>bluebird</code>設定成<code>true</code></p>\n<blockquote>\n<p>Bluebird 為了支援 Promise ，詳細的相容性可以到 <a href=\"https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise#瀏覽器相容性\" target=\"_blank\" rel=\"noopener\">MDN</a> 上看</p>\n</blockquote>\n<p>改完的 _config.yml:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">firestore:</span></span><br><span class=\"line\"><span class=\"attr\">  enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"attr\">  collection:</span> <span class=\"string\">articles</span></span><br><span class=\"line\"><span class=\"attr\">  apiKey:</span> <span class=\"string\">AIzaSyDcPXjPoq3kEL245f4P4SDPop7uAD-XZXc</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  projectId:</span> <span class=\"string\">hexo-next-firestore-example</span> <span class=\"comment\">#required</span></span><br><span class=\"line\"><span class=\"attr\">  bluebird:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"測試\"><a href=\"#測試\" class=\"headerlink\" title=\"測試\"></a>測試</h2><p>接下來執行<code>hexo s</code>啟動測試伺服器應該要在首頁的每篇文章的標題下面看到<strong>閱讀次數</strong></p>\n<p>然後點進任何一篇文章也要在標題下面看到<strong>閱讀次數</strong><br><img src=\"./example.jpg\" alt=\"預覽圖\"></p>\n<h2 id=\"firestore-安全設定\"><a href=\"#firestore-安全設定\" class=\"headerlink\" title=\"firestore 安全設定\"></a>firestore 安全設定</h2><p><strong>這個步驟可做可不做</strong></p>\n<p>接下來在 firebase 裡面回到 Database 頁面，然後選擇上面的<strong>規則</strong><br><img src=\"./rule.jpg\" alt=\"firestore規則\"></p>\n<p>把裡面的值改成下面的來限制只有<code>articles</code>這個 collection 可以被修改如果在前面的設定裡的<code>collection</code>的值不是<code>articles</code>的話下面也要修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service cloud.firestore &#123;</span><br><span class=\"line\">  match /databases/&#123;database&#125;/documents &#123;</span><br><span class=\"line\">    match /articles/&#123;any&#125; &#123;</span><br><span class=\"line\">      allow read: if true;</span><br><span class=\"line\">      allow write: if request.resource.data.count==resource.data.count+1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"後記\"><a href=\"#後記\" class=\"headerlink\" title=\"後記\"></a>後記</h1><p>會弄出這個功能的原因是不想使用原本就有的 <a href=\"https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud\" target=\"_blank\" rel=\"noopener\">LeanCloud 統計功能</a> (這個的設定方法比較簡單)<br>所以就自己用 javascript 來簡單的實作了一個統計次數的功能然後發 PR 給主題</p>","categories":[{"name":"教學","path":"api/categories/教學.json"}],"tags":[{"name":"hexo","path":"api/tags/hexo.json"},{"name":"firestore","path":"api/tags/firestore.json"}]}