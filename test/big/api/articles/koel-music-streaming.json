{"title":"koel 私人音樂串流伺服器","slug":"koel-music-streaming","date":"2018-03-10T09:37:59.000Z","updated":"2019-08-16T11:14:47.594Z","comments":true,"path":"api/articles/koel-music-streaming.json","excerpt":"koel 是一個用 Laravel+Vue.js 做的開源音樂串流伺服器架設好之後是蠻方便的，在手機 ipad 之類的裝置上只要打開瀏覽器就能直接播放電腦上的音樂這篇文章是一篇簡單的在 Windows 上建立 koel 伺服器的教學官方教學: Koel docs<br>不過官方的教學稍微簡略了一些，對 Windows 使用者來說可能不是簡單的能依照上面搞定，因此才有這篇文章的出現","covers":["koel_example.png"],"content":"<p><a href=\"https://koel.phanan.net/\" target=\"_blank\" rel=\"noopener\">koel</a> 是一個用 Laravel+Vue.js 做的開源音樂串流伺服器架設好之後是蠻方便的，在手機 ipad 之類的裝置上只要打開瀏覽器就能直接播放電腦上的音樂</p>\n<p>這篇文章是一篇簡單的在 Windows 上建立 koel 伺服器的教學</p>\n<p>官方教學: <a href=\"https://koel.phanan.net/docs/\" target=\"_blank\" rel=\"noopener\">Koel docs</a><br>不過官方的教學稍微簡略了一些，對 Windows 使用者來說可能不是簡單的能依照上面搞定，因此才有這篇文章的出現</p>\n<a id=\"more\"></a>\n\n<p>預覽圖:<br><img src=\"koel_example.png\" alt=\"koel example\"></p>\n<h1 id=\"前置準備\"><a href=\"#前置準備\" class=\"headerlink\" title=\"前置準備\"></a>前置準備</h1><blockquote>\n<p>所有的指令請在有管理員權限的 powershell 下執行</p>\n</blockquote>\n<h2 id=\"Chocolatey\"><a href=\"#Chocolatey\" class=\"headerlink\" title=\"Chocolatey\"></a>Chocolatey</h2><p>為了能輕鬆的安裝必要的軟體，需要先安裝 <a href=\"https://chocolatey.org/\" target=\"_blank\" rel=\"noopener\">Chocolatey</a></p>\n<p>官方的<a href=\"https://chocolatey.org/install#install-with-powershellexe\" target=\"_blank\" rel=\"noopener\">安裝教學</a></p>\n<p>執行下面這行指令</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Set-ExecutionPolicy</span> Bypass -Scope <span class=\"keyword\">Process</span> -Force; iex ((<span class=\"built_in\">New-Object</span> System.Net.WebClient).DownloadString(<span class=\"string\">'https://chocolatey.org/install.ps1'</span>))</span><br></pre></td></tr></table></figure>\n\n<p>然後執行 <code>choco -v</code> 指令，如果沒有出現錯誤並顯示版本號就代表安裝成功了</p>\n<h2 id=\"php-amp-composer\"><a href=\"#php-amp-composer\" class=\"headerlink\" title=\"php &amp; composer\"></a>php &amp; composer</h2><p>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco install php composer -y</span><br></pre></td></tr></table></figure>\n\n<p>然後可能要稍微等一段時間下載與安裝完成後可以用 <code>php -v</code> 和 <code>composer -V</code> 來看有沒有安裝成功</p>\n<p>接下來 koel 需要啟用一些 php 的 extension 才能正常使用</p>\n<p>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php --ini</span><br><span class=\"line\"><span class=\"comment\"># 輸出:</span></span><br><span class=\"line\"><span class=\"comment\"># Configuration File (php.ini) Path: C:\\WINDOWS</span></span><br><span class=\"line\"><span class=\"comment\"># Loaded Configuration File:         C:\\tools\\php72\\php.ini</span></span><br><span class=\"line\"><span class=\"comment\"># Scan for additional .ini files in: (none)</span></span><br><span class=\"line\"><span class=\"comment\"># Additional .ini files parsed:      (none)</span></span><br></pre></td></tr></table></figure>\n\n<p>然後用文字編輯器打開 <code>Loaded Configuration File:</code> 後面顯示的檔案</p>\n<p>在檔案中找到 <code>;extension=exif</code>,<code>;extension=pdo_sqlite</code>,<code>;extension=fileinfo</code><br>分別改成 <code>extension=exif</code>,<code>extension=pdo_sqlite</code>,<code>extension=fileinfo</code> 然後儲存檔案</p>\n<h2 id=\"node-js-amp-yarn-amp-git\"><a href=\"#node-js-amp-yarn-amp-git\" class=\"headerlink\" title=\"node.js &amp; yarn &amp; git\"></a>node.js &amp; yarn &amp; git</h2><p>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco install nodejs yarn git -y</span><br></pre></td></tr></table></figure>\n\n<p>一樣能透過 <code>node -v</code> 和 <code>yarn -v</code> 檢查是否安裝成功<br>這個就沒有什麼東西需要額外設定的了</p>\n<h1 id=\"安裝\"><a href=\"#安裝\" class=\"headerlink\" title=\"安裝\"></a>安裝</h1><h2 id=\"下載\"><a href=\"#下載\" class=\"headerlink\" title=\"下載\"></a>下載</h2><p>這邊假設想把 koel 安裝到 <code>D:\\koel</code> 的位置<br>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd D: <span class=\"comment\"># 切換到 D 槽</span></span><br><span class=\"line\">git clone https://github.com/phanan/koel.git koel <span class=\"comment\"># 後面的 koel 是資料夾名稱</span></span><br><span class=\"line\">cd koel <span class=\"comment\"># 進入資料夾</span></span><br><span class=\"line\">git checkout v3.<span class=\"number\">7.2</span> <span class=\"comment\"># 在 https://github.com/phanan/koel/releases 檢查最新版的版本號</span></span><br><span class=\"line\">composer install <span class=\"comment\"># 安裝一些必要的 package</span></span><br><span class=\"line\"><span class=\"built_in\">New-Item</span> database/e2e.sqlite -type file <span class=\"comment\"># 建立資料庫檔案 database/e2e.sqlite，之後會用到</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>要把上面的指令執行完成可能也要不少時間，尤其是 <code>composer install</code> 最慢(大概 5 分鐘)</p>\n</blockquote>\n<h2 id=\"設定\"><a href=\"#設定\" class=\"headerlink\" title=\"設定\"></a>設定</h2><p>再來是要執行 <code>php artisan koel:init</code> ，這個指令會互動式的問好幾個問題<br>例如音樂的資料夾位置，管理員的名稱、信箱、密碼</p>\n<p>不過其中有一項是 <code>Database</code> (資料庫)，這一項請輸入 <code>sqlite</code><br>然後後面問你的 sqlite 位置請填 <code>D:\\koel\\database\\e2e.sqlite</code> (絕對路徑，前面要根據你的資料夾位置更改)</p>\n<blockquote>\n<p>如果前面詢問音樂資料夾時已經有填入位置的話，建議先執行 <code>php artisan koel:sync</code> 來初次更新資料庫</p>\n</blockquote>\n<p>到這邊安裝已經完成了，輸入 <code>php artisan serve</code> 然後打開 <a href=\"http://localhost:8000\" target=\"_blank\" rel=\"noopener\">http://localhost:8000</a> 應該就能看到登入介面</p>\n<p>輸入前面所設定的 email 和密碼之後就能進到介面並在瀏覽器中享受音樂</p>\n<blockquote>\n<p>如需在網頁介面設定音樂資料夾位置的話<br>進入左側 <code>Settings</code><br>然後在 <code>Media Path</code> 欄位填音樂資料夾的絕對路徑</p>\n</blockquote>\n<h2 id=\"更改-port\"><a href=\"#更改-port\" class=\"headerlink\" title=\"更改 port\"></a>更改 port</h2><p>如果不想要使用 port 8000 的話可以把指令改成<br><code>php artisan serve --port=1234</code> 這樣就會讓 port 開在 1234</p>\n<h1 id=\"允許同-wifi-使用-koel\"><a href=\"#允許同-wifi-使用-koel\" class=\"headerlink\" title=\"允許同 wifi 使用 koel\"></a>允許同 wifi 使用 koel</h1><p>執行指令 <code>ipconfig</code> 應該能看到自己在 wifi 下的 ip，例如我是 <code>192.168.0.20</code><br>如果在手機或其他在同個 wifi 下的裝置用瀏覽器瀏覽 <code>192.168.0.20:8000</code> 時已經可以的話建議可以跳過這一段</p>\n<p>在 koel 的資料夾下用文字編輯器打開 <code>.env</code>，並找到一行 <code>APP_URL=xxx</code><br>把 <code>xxx</code> 改成 <code>http://192.168.0.20</code> 這樣的網址 <strong>請自己替換成正確的 ip</strong></p>\n<p>然後未來的啟動伺服器指令要改成 <code>php artisan serve --host=192.168.0.20</code> 才能使用 <code>192.168.0.20</code> 來連接</p>\n<h1 id=\"背景自動啟動\"><a href=\"#背景自動啟動\" class=\"headerlink\" title=\"背景自動啟動\"></a>背景自動啟動</h1><h2 id=\"背景啟動\"><a href=\"#背景啟動\" class=\"headerlink\" title=\"背景啟動\"></a>背景啟動</h2><p>自動啟動如果直接使用 batch 來做會導致視窗不會關掉的問題，所以會使用到 vbscript</p>\n<p>在 koel 的資料夾底下建立一個檔案叫 <code>init.vbs</code><br>內容打上:</p>\n<figure class=\"highlight vbs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">CreateObject</span>(<span class=\"string\">\"WScript.Shell\"</span>).Run <span class=\"string\">\"php artisan serve --host=192.168.0.20\"</span>,<span class=\"number\">0</span>,<span class=\"literal\">True</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>中間的字串要改成自己要的啟動指令</p>\n</blockquote>\n<p>這樣只要在 <code>init.vbs</code> 上點兩下就會自動啟動伺服器並讓視窗消失</p>\n<h2 id=\"開機自動執行\"><a href=\"#開機自動執行\" class=\"headerlink\" title=\"開機自動執行\"></a>開機自動執行</h2><p>按下 <code>win+R</code>，在<strong>執行</strong>的視窗中輸入 <code>shell:startup</code> 並按確定就會打開一個資料夾<br>這個資料夾裡的檔案在開機時都會被自動執行，所以要在這邊建立 <code>initkoel.bat</code><br>內容則打上:</p>\n<figure class=\"highlight bat\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /d D:\\koel</span><br><span class=\"line\"><span class=\"built_in\">start</span> /b init.vbs</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>要把 cd 的路徑改成你的 koel 資料夾<br>如果不是放在 <code>C:</code>，就不能把 <code>\\d</code> 拿掉</p>\n</blockquote>\n<h1 id=\"Youtube-amp-Last-fm\"><a href=\"#Youtube-amp-Last-fm\" class=\"headerlink\" title=\"Youtube &amp; Last.fm\"></a>Youtube &amp; Last.fm</h1><p>官方的教學: <a href=\"https://koel.phanan.net/docs/#/3rd-party\" target=\"_blank\" rel=\"noopener\">https://koel.phanan.net/docs/#/3rd-party</a></p>\n<p>待補…</p>\n","more":"<p>預覽圖:<br><img src=\"koel_example.png\" alt=\"koel example\"></p>\n<h1 id=\"前置準備\"><a href=\"#前置準備\" class=\"headerlink\" title=\"前置準備\"></a>前置準備</h1><blockquote>\n<p>所有的指令請在有管理員權限的 powershell 下執行</p>\n</blockquote>\n<h2 id=\"Chocolatey\"><a href=\"#Chocolatey\" class=\"headerlink\" title=\"Chocolatey\"></a>Chocolatey</h2><p>為了能輕鬆的安裝必要的軟體，需要先安裝 <a href=\"https://chocolatey.org/\" target=\"_blank\" rel=\"noopener\">Chocolatey</a></p>\n<p>官方的<a href=\"https://chocolatey.org/install#install-with-powershellexe\" target=\"_blank\" rel=\"noopener\">安裝教學</a></p>\n<p>執行下面這行指令</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Set-ExecutionPolicy</span> Bypass -Scope <span class=\"keyword\">Process</span> -Force; iex ((<span class=\"built_in\">New-Object</span> System.Net.WebClient).DownloadString(<span class=\"string\">'https://chocolatey.org/install.ps1'</span>))</span><br></pre></td></tr></table></figure>\n\n<p>然後執行 <code>choco -v</code> 指令，如果沒有出現錯誤並顯示版本號就代表安裝成功了</p>\n<h2 id=\"php-amp-composer\"><a href=\"#php-amp-composer\" class=\"headerlink\" title=\"php &amp; composer\"></a>php &amp; composer</h2><p>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco install php composer -y</span><br></pre></td></tr></table></figure>\n\n<p>然後可能要稍微等一段時間下載與安裝完成後可以用 <code>php -v</code> 和 <code>composer -V</code> 來看有沒有安裝成功</p>\n<p>接下來 koel 需要啟用一些 php 的 extension 才能正常使用</p>\n<p>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php --ini</span><br><span class=\"line\"><span class=\"comment\"># 輸出:</span></span><br><span class=\"line\"><span class=\"comment\"># Configuration File (php.ini) Path: C:\\WINDOWS</span></span><br><span class=\"line\"><span class=\"comment\"># Loaded Configuration File:         C:\\tools\\php72\\php.ini</span></span><br><span class=\"line\"><span class=\"comment\"># Scan for additional .ini files in: (none)</span></span><br><span class=\"line\"><span class=\"comment\"># Additional .ini files parsed:      (none)</span></span><br></pre></td></tr></table></figure>\n\n<p>然後用文字編輯器打開 <code>Loaded Configuration File:</code> 後面顯示的檔案</p>\n<p>在檔案中找到 <code>;extension=exif</code>,<code>;extension=pdo_sqlite</code>,<code>;extension=fileinfo</code><br>分別改成 <code>extension=exif</code>,<code>extension=pdo_sqlite</code>,<code>extension=fileinfo</code> 然後儲存檔案</p>\n<h2 id=\"node-js-amp-yarn-amp-git\"><a href=\"#node-js-amp-yarn-amp-git\" class=\"headerlink\" title=\"node.js &amp; yarn &amp; git\"></a>node.js &amp; yarn &amp; git</h2><p>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choco install nodejs yarn git -y</span><br></pre></td></tr></table></figure>\n\n<p>一樣能透過 <code>node -v</code> 和 <code>yarn -v</code> 檢查是否安裝成功<br>這個就沒有什麼東西需要額外設定的了</p>\n<h1 id=\"安裝\"><a href=\"#安裝\" class=\"headerlink\" title=\"安裝\"></a>安裝</h1><h2 id=\"下載\"><a href=\"#下載\" class=\"headerlink\" title=\"下載\"></a>下載</h2><p>這邊假設想把 koel 安裝到 <code>D:\\koel</code> 的位置<br>執行:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd D: <span class=\"comment\"># 切換到 D 槽</span></span><br><span class=\"line\">git clone https://github.com/phanan/koel.git koel <span class=\"comment\"># 後面的 koel 是資料夾名稱</span></span><br><span class=\"line\">cd koel <span class=\"comment\"># 進入資料夾</span></span><br><span class=\"line\">git checkout v3.<span class=\"number\">7.2</span> <span class=\"comment\"># 在 https://github.com/phanan/koel/releases 檢查最新版的版本號</span></span><br><span class=\"line\">composer install <span class=\"comment\"># 安裝一些必要的 package</span></span><br><span class=\"line\"><span class=\"built_in\">New-Item</span> database/e2e.sqlite -type file <span class=\"comment\"># 建立資料庫檔案 database/e2e.sqlite，之後會用到</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>要把上面的指令執行完成可能也要不少時間，尤其是 <code>composer install</code> 最慢(大概 5 分鐘)</p>\n</blockquote>\n<h2 id=\"設定\"><a href=\"#設定\" class=\"headerlink\" title=\"設定\"></a>設定</h2><p>再來是要執行 <code>php artisan koel:init</code> ，這個指令會互動式的問好幾個問題<br>例如音樂的資料夾位置，管理員的名稱、信箱、密碼</p>\n<p>不過其中有一項是 <code>Database</code> (資料庫)，這一項請輸入 <code>sqlite</code><br>然後後面問你的 sqlite 位置請填 <code>D:\\koel\\database\\e2e.sqlite</code> (絕對路徑，前面要根據你的資料夾位置更改)</p>\n<blockquote>\n<p>如果前面詢問音樂資料夾時已經有填入位置的話，建議先執行 <code>php artisan koel:sync</code> 來初次更新資料庫</p>\n</blockquote>\n<p>到這邊安裝已經完成了，輸入 <code>php artisan serve</code> 然後打開 <a href=\"http://localhost:8000\" target=\"_blank\" rel=\"noopener\">http://localhost:8000</a> 應該就能看到登入介面</p>\n<p>輸入前面所設定的 email 和密碼之後就能進到介面並在瀏覽器中享受音樂</p>\n<blockquote>\n<p>如需在網頁介面設定音樂資料夾位置的話<br>進入左側 <code>Settings</code><br>然後在 <code>Media Path</code> 欄位填音樂資料夾的絕對路徑</p>\n</blockquote>\n<h2 id=\"更改-port\"><a href=\"#更改-port\" class=\"headerlink\" title=\"更改 port\"></a>更改 port</h2><p>如果不想要使用 port 8000 的話可以把指令改成<br><code>php artisan serve --port=1234</code> 這樣就會讓 port 開在 1234</p>\n<h1 id=\"允許同-wifi-使用-koel\"><a href=\"#允許同-wifi-使用-koel\" class=\"headerlink\" title=\"允許同 wifi 使用 koel\"></a>允許同 wifi 使用 koel</h1><p>執行指令 <code>ipconfig</code> 應該能看到自己在 wifi 下的 ip，例如我是 <code>192.168.0.20</code><br>如果在手機或其他在同個 wifi 下的裝置用瀏覽器瀏覽 <code>192.168.0.20:8000</code> 時已經可以的話建議可以跳過這一段</p>\n<p>在 koel 的資料夾下用文字編輯器打開 <code>.env</code>，並找到一行 <code>APP_URL=xxx</code><br>把 <code>xxx</code> 改成 <code>http://192.168.0.20</code> 這樣的網址 <strong>請自己替換成正確的 ip</strong></p>\n<p>然後未來的啟動伺服器指令要改成 <code>php artisan serve --host=192.168.0.20</code> 才能使用 <code>192.168.0.20</code> 來連接</p>\n<h1 id=\"背景自動啟動\"><a href=\"#背景自動啟動\" class=\"headerlink\" title=\"背景自動啟動\"></a>背景自動啟動</h1><h2 id=\"背景啟動\"><a href=\"#背景啟動\" class=\"headerlink\" title=\"背景啟動\"></a>背景啟動</h2><p>自動啟動如果直接使用 batch 來做會導致視窗不會關掉的問題，所以會使用到 vbscript</p>\n<p>在 koel 的資料夾底下建立一個檔案叫 <code>init.vbs</code><br>內容打上:</p>\n<figure class=\"highlight vbs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">CreateObject</span>(<span class=\"string\">\"WScript.Shell\"</span>).Run <span class=\"string\">\"php artisan serve --host=192.168.0.20\"</span>,<span class=\"number\">0</span>,<span class=\"literal\">True</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>中間的字串要改成自己要的啟動指令</p>\n</blockquote>\n<p>這樣只要在 <code>init.vbs</code> 上點兩下就會自動啟動伺服器並讓視窗消失</p>\n<h2 id=\"開機自動執行\"><a href=\"#開機自動執行\" class=\"headerlink\" title=\"開機自動執行\"></a>開機自動執行</h2><p>按下 <code>win+R</code>，在<strong>執行</strong>的視窗中輸入 <code>shell:startup</code> 並按確定就會打開一個資料夾<br>這個資料夾裡的檔案在開機時都會被自動執行，所以要在這邊建立 <code>initkoel.bat</code><br>內容則打上:</p>\n<figure class=\"highlight bat\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /d D:\\koel</span><br><span class=\"line\"><span class=\"built_in\">start</span> /b init.vbs</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>要把 cd 的路徑改成你的 koel 資料夾<br>如果不是放在 <code>C:</code>，就不能把 <code>\\d</code> 拿掉</p>\n</blockquote>\n<h1 id=\"Youtube-amp-Last-fm\"><a href=\"#Youtube-amp-Last-fm\" class=\"headerlink\" title=\"Youtube &amp; Last.fm\"></a>Youtube &amp; Last.fm</h1><p>官方的教學: <a href=\"https://koel.phanan.net/docs/#/3rd-party\" target=\"_blank\" rel=\"noopener\">https://koel.phanan.net/docs/#/3rd-party</a></p>\n<p>待補…</p>","categories":[{"name":"教學","path":"api/categories/教學.json"}],"tags":[{"name":"php","path":"api/tags/php.json"},{"name":"music","path":"api/tags/music.json"}]}